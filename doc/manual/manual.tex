\documentclass{article}
\usepackage[pdftex]{graphicx,color}
\usepackage[T1]{fontenc}
\usepackage{lmodern}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{subfigure}
\usepackage{textpos}

% use a larger page size; otherwise, it is difficult to have complete
% code listings and output on a single page
\usepackage{fullpage}

% have an index. we use the imakeidx' replacement of the 'multind' package so
% that we can have an index of all run-time parameters separate from other
% items (if we ever wanted one)
\usepackage{imakeidx}
\makeindex[name=prmindex, title=Index of run-time parameter entries]
\makeindex[name=prmindexfull, title=Index of run-time parameters with section names]

% be able to use \note environments with a box around the text
\usepackage{fancybox}
\newcommand{\note}[1]{
{\parindent0pt
  \begin{center}
    \shadowbox{
      \begin{minipage}[c]{0.9\linewidth}
        \textbf{Note:} #1
      \end{minipage}
    }
  \end{center}
}}

% use the listings package for code snippets. define keywords for prm files
% and for gnuplot
\usepackage{listings}
\lstset{
  language=C++,
  showstringspaces=false,
  basicstyle=\small\ttfamily,
  columns=fullflexible,
  keepspaces=true,
  frame=single,
  breaklines=true,
  postbreak=\raisebox{0ex}[0ex][0ex]{\hspace{5em}\ensuremath{\color{red}\hookrightarrow\space}}
}
\lstdefinelanguage{prmfile}{morekeywords={set,subsection,end},
                            morecomment=[l]{\#},escapeinside={\%\%}{\%},}
\lstdefinelanguage{gnuplot}{morekeywords={plot,using,title,with,set,replot},
                            morecomment=[l]{\#},}


% use the hyperref package; set the base for relative links to
% the top-level aspect directory so that we can link to
% files in the aspect tree without having to specify the
% location relative to the directory where the pdf actually
% resides
\usepackage[colorlinks,linkcolor=blue,urlcolor=blue,citecolor=blue,baseurl=../]{hyperref}

\newcommand{\dealii}{{\textsc{deal.II}}}
\newcommand{\pfrst}{{\normalfont\textsc{p4est}}}
\newcommand{\trilinos}{{\textsc{Trilinos}}}
\newcommand{\petsc}{{\textsc{PETSc}}}
\newcommand{\aspect}{\textsc{ASPECT}}

\begin{document}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% START OF CIG MANUAL COVER TEMPLATE %%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% This should be pasted at the start of manuals and appropriate strings entered at locations indicated with FILL.
% Be sure the TeX file includes the following packages.
% \usepackage{graphicx}
% \usepackage{times}
% \usepackage{textpos}

\definecolor{dark_grey}{gray}{0.3}
\definecolor{aspect_blue}{rgb}{0.3125,0.6875,0.9375}

%LINE 1%
{
\renewcommand{\familydefault}{\sfdefault}

\pagenumbering{gobble}
\begin{center}
\resizebox{\textwidth}{!}{\textcolor{dark_grey}{\fontfamily{\sfdefault}\selectfont
COMPUTATIONAL INFRASTRUCTURE FOR GEODYNAMICS (CIG)
}}

\hrule

%LINE 2%
\color{dark_grey}
\rule{\textwidth}{2pt}

%LINE 3%
\color{dark_grey}
% FILL: additional organizations
% e.g.: {\Large Organization 1\\Organization 2}
{\Large }
\end{center}

%COLOR AND CODENAME BLOCK%
\begin{center}
\resizebox{\textwidth}{!}{\colorbox
% FILL: color of code name text box
% e.g. blue
{aspect_blue}{\fontfamily{\rmdefault}\selectfont \textcolor{white} {
% FILL: name of the code
% You may want to add \hspace to both sides of the codename to better center it, such as:
% \newcommand{\codename}{\hspace{0.1in}CodeName\hspace{0.1in}}
\hspace{0.1in}\aspect{}\hspace{0.1in}
}}}
\\[12pt]
{\Large Advanced Solver for Problems in Earth's ConvecTion}
\end{center}

%MAIN PICTURE%
\begin{textblock*}{0in}(1.5in,0.3in)
% FILL: image height
% e.g. height=6.5in
\begin{center}
\vspace{1em}
\includegraphics[height=3.5in]
% FILL: image file name
% e.g. cover_image.png
{mesh-2d.png}
\hspace{5em}
\end{center}
\end{textblock*}

%USER MANUAL%
\color{dark_grey}
\hfill{\Huge \fontfamily{\sfdefault}\selectfont User Manual \\
\raggedleft \huge \fontfamily{\sfdefault}\selectfont Version
% keep the following line as is so that we can replace this using a script:
2.1.0-pre %VERSION-INFO%
\\\large(generated \today)\\
{\Large Wolfgang Bangerth\\Juliane Dannberg\\Rene Gassm{\"o}ller\\Timo Heister\\}
}

%AUTHOR(S) & WEBSITE%
\null
\vspace{17em}
\color{dark_grey}
{\fontfamily{\sfdefault}\selectfont
% FILL: author list
% e.g. Author One\\Author Two\\Author Three\\
% be sure to have a newline (\\) after the final author
\large
\noindent with contributions by: \\
    Jacqueline Austermann,
    Markus B{\"u}rg,
    Samuel Cox,
    William Durkin,
    Grant Euen,
    Menno Fraters,
    Thomas Geenen,
    Anne Glerum,
    Ryan Grove,
    Eric Heien,
    Louise Kellogg,
    Scott King,
    Martin Kronbichler,
    Marine Lasbleis,
    Shangxin Liu,
    Elvira Mulyukova,
    John Naliboff,
    Jonathan Perry-Houts,
    Elbridge Gerry Puckett,
    Tahiry Rajaonarison,
    Ian Rose,
    D.~Sarah Stamps,
    Cedric Thieulot,
    Iris van Zelst,
    Siqi Zhang \\
\vspace{1.0em}
}

{\noindent
{\fontfamily{\sfdefault}\selectfont \href{https://geodynamics.org}{geodynamics.org}}
}

%LINE%
{\noindent
\color{dark_grey}
\rule{\textwidth}{2pt}
}

}

\pagebreak
\pagenumbering{arabic}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%   END OF CIG MANUAL COVER TEMPLATE    %%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\pagebreak

\tableofcontents

\pagebreak

\input{intro}

\input{models}

\input{installation}

\input{running}

\input{cookbooks}

\input{contributing}


\section{Future plans for \aspect}
\label{sec:future}

We have a number of near-term plans for \aspect{} that we hope to implement
soon:
\begin{itemize}
\item \textit{Better ways to deal with the nonlinearity:} The simplest algorithm
to deal with the nonlinearity of the equations is to use the velocity, pressure and temperature of the
previous time step to evaluate the coefficients that appear in the flow
equations \eqref{eq:stokes-1}--\eqref{eq:stokes-2}; and the velocity and
pressure of the current time step as well as the previous time step's
temperature to evaluate the coefficients in the temperature equation
\eqref{eq:temperature}. A slight improvement of this scheme -- and the one that
is the default in \aspect{} -- is to use velocities, pressures, and temperatures
that are extrapolated from previous time steps to the current time.
This is an appropriate strategy if the model is not too
nonlinear; however, it introduces inaccuracies and limits the size of the
time step if coefficients strongly depend on the solution variables.

  To avoid this, one can iterate out the equations using either a fixed point
  or Newton scheme. Both approaches ensure that at the end of a time step, the
  values of coefficients and solution variables are consistent. On the other
  hand, one may have to solve the linear systems that describe a time step
  more than once, increasing the computational effort.

  \aspect{} currently already implements methods that iterate out the
  nonlinearity based on various fixed point strategies. These are based on some
  earlier experiments by Jennifer Worthen \cite{Wor12}. What is missing, though,
  is a proper Newton method.

\item \textit{Faster 3d computations:} Whichever way you look at it, 3d
  computations are expensive. In parallel computations, the Stokes solve
  currently takes upward of 90\% of the overall wallclock time, suggesting an
  obvious target for improvements based on better algorithms as well as from
  profiling the code to find hot spots. In particular, playing with better
  solver and/or preconditioner options would seem to be a useful goal.

\item \textit{More, and more realistic material models:} The number of
  material models available in \aspect{} is sizeable, but it does not include
  all models that have in the past been used in the literature. On the other
  hand, how realistic a simulation is depends on how realistic the used
  material model is. We hope to obtain more descriptions of realistic
  material descriptions over time, either given analytically or based on
  table-lookup of material properties.
\end{itemize}




\section{Finding answers to more questions}
\label{sec:questions-and-answers}

If you have questions that go beyond this manual, there are a number of
resources:
\begin{itemize}
\item For questions on the source code of \aspect{}, portability, installation,
  etc., use the \aspect{} development mailing list at
  \url{http://lists.geodynamics.org/cgi-bin/mailman/listinfo/aspect-devel}. This
  mailing list is where the \aspect{} developers all hang out.

\item \aspect{} is primarily based on the deal.II library (the dependency
  on Trilinos and p4est is primarily through deal.II, and not directly
  visible in the \aspect{} source code). If you have particular questions
  about deal.II, contact
  the mailing lists described at \url{https://www.dealii.org/mail.html}.

\item In case of more general questions about mantle convection, you can
  contact the CIG mantle
  convection mailing lists at 
  \url{http://lists.geodynamics.org/cgi-bin/mailman/listinfo/cig-MC}.

\item If you have specific questions about \aspect{} that are not suitable
  for public and archived mailing lists, you can contact the
  primary developers:
  \begin{itemize}
  \item Wolfgang
    Bangerth: \url{bangerth@colostate.edu}.
  \item Juliane
    Dannberg: \url{judannberg@gmail.com}
  \item Rene
    Gassm{\"o}ller: \url{rene.gassmoeller@mailbox.org}
  \item Timo
    Heister: \url{heister@clemson.edu}.
  \end{itemize}
\end{itemize}


\appendix

\section{Run-time input parameters}
\label{sec:parameters}

% now include a file that describes all currently available run-time parameters
\input{parameters}


\pagebreak

% print the list of references. make sure the page number in the index is
% correct by putting the \addcontentsline inside the command that prints the
% title of the page, see http://www.dfki.de/~loeckelt/latexbib.html

\let\myRefname\refname
\renewcommand\refname{%
  \addcontentsline{toc}{section}{\numberline{}References}
  \myRefname
}
\bibliographystyle{alpha}
\bibliography{manual}


\pagebreak

% print the index. note that we put the \label and \addcontentsline into the
% text printed at the top to make sure they get processed when latex is
% already on the page where this shows up (otherwise we end up with wrong page
% labels)
\indexprologue{The following is a listing of all run-time parameters that can
  be set in the input parameter file. They are all described in
  Section~\ref{sec:parameters} and the listed page numbers are where their
  detailed documentation can be found. A listing of all parameters sorted by
  the section name in which they are declared is given in the index on
  page~\pageref{sec:runtime-parameter-index-full} below.
  \addcontentsline{toc}{section}{\numberline{}Index of run-time parameter
    entries}
  \label{sec:runtime-parameter-index}
}
\printindex[prmindex]

\indexprologue{The following is a listing of all run-time parameters, sorted
  by the section in which they appear. To find entries sorted by their name,
  rather than their section, see the index on
  page~\pageref{sec:runtime-parameter-index} above.
  \addcontentsline{toc}{section}{\numberline{}Index of run-time parameters with
    section names}
  \label{sec:runtime-parameter-index-full}
}
\printindex[prmindexfull]

\end{document}
